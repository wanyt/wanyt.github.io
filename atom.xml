<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://localhost:4000</id>
    <title>Gridea</title>
    <updated>2019-11-20T03:49:30.802Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://localhost:4000"/>
    <link rel="self" href="http://localhost:4000/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>http://localhost:4000/images/avatar.png</logo>
    <icon>http://localhost:4000/favicon.ico</icon>
    <rights>All rights reserved 2019, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[H]]></title>
        <id>http://localhost:4000/post/h</id>
        <link href="http://localhost:4000/post/h">
        </link>
        <updated>2019-11-18T07:14:00.000Z</updated>
        <content type="html"><![CDATA[<h1 id="handlerå’Œå†…å­˜æ³„æ¼">Handlerå’Œå†…å­˜æ³„æ¼</h1>
<p>é¢è¯•ç»å¸¸ä¼šé—®ä»€ä¹ˆæ“ä½œä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ï¼Ÿ</p>
<p>æœ¬æ–‡ç« éªŒè¯ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>Handlerå¦‚ä½•é€ æˆå†…å­˜æ³„æ¼</li>
<li>Handlerå¯¼è‡´å†…å­˜æ³„æ¼çš„å½±å“å¦‚ä½•</li>
<li>å¦‚ä½•é¿å…Handleré€ æˆçš„å†…å­˜æ³„æ¼</li>
</ol>
<h2 id="profileç®€å•ä½¿ç”¨">Profileç®€å•ä½¿ç”¨</h2>
<h2 id="handlerå¦‚ä½•é€ æˆå†…å­˜æ³„æ¼">Handlerå¦‚ä½•é€ æˆå†…å­˜æ³„æ¼</h2>
<h2 id="handlerå¯¼è‡´å†…å­˜æ³„æ¼çš„å½±å“å¦‚ä½•">Handlerå¯¼è‡´å†…å­˜æ³„æ¼çš„å½±å“å¦‚ä½•</h2>
<h2 id="å¦‚ä½•é¿å…handleré€ æˆçš„å†…å­˜æ³„æ¼">å¦‚ä½•é¿å…Handleré€ æˆçš„å†…å­˜æ³„æ¼</h2>
<ol>
<li>ä¿¡ä»¤æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿsfuæ˜¯ä¸ä¼ é€’ä¿¡ä»¤çš„</li>
</ol>
<p>#blog</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Flutteré¡µé¢å¯¼èˆªï¼ˆä¸€ï¼‰]]></title>
        <id>http://localhost:4000/post/flutter-ye-mian-dao-hang-yi</id>
        <link href="http://localhost:4000/post/flutter-ye-mian-dao-hang-yi">
        </link>
        <updated>2019-10-27T14:08:22.000Z</updated>
        <content type="html"><![CDATA[<p>æˆ‘åˆšæ¥è§¦Flutterçš„é¡µé¢è·³è½¬ä¼šæ„Ÿè§‰æœ‰ç‚¹æ€ªå¼‚ï¼Œä¸»è¦è¿˜æ˜¯å¯¹Dartè¯­æ³•ä¸ç†Ÿæ‚‰ã€‚Androidï¼ŒIOSåº”ç”¨ä¸­çš„é¡µé¢åœ¨Flutterä¸­è¢«å«åšRouteï¼Œåº”ç”¨ä¸­çš„æ‰€æœ‰çš„Routeè¢«Navigatorç»Ÿä¸€ç®¡ç†ã€‚Navigatorå®šä¹‰äº†ä¸€ç³»åˆ—é¡µé¢è·³è½¬çš„æ–¹æ³•ï¼Œæ¯”å¦‚<code>Navigator.push()</code>ï¼Œ<code>Navigator.pop()</code>ã€‚Navigatoræ˜¯ç»§æ‰¿è‡ªStatefulWidgetçš„Widgetï¼ˆæ²¡é”™Flutteré‡Œä¸€åˆ‡éƒ½æ˜¯Widgetï¼‰ã€‚</p>
<p>ä¸Šé¢åˆ—ä¸¾çš„ä¸¤ä¸ªæ–¹æ³•<code>Navigator.push()</code>å’Œ<code>Navigator.pop()</code>åˆ†åˆ«å¯¹åº”æ‰“å¼€é¡µé¢å’Œå…³é—­é¡µé¢ã€‚åœ¨Flutterä¸­ï¼Œæ‰“å¼€é¡µé¢åˆåˆ†ä¸ºä½¿ç”¨Routeå¯¹è±¡æ‰“å¼€â€”â€”push()ç³»åˆ—æ–¹æ³•å’ŒæŒ‰ç…§è·¯å¾„æ‰“å¼€â€”â€”pushNamed()ç³»åˆ—æ–¹æ³•ã€‚</p>
<h2 id="push">push()</h2>
<p><code>static Future&lt;T&gt; push&lt;T extends Object&gt;(BuildContext context, Route&lt;T&gt; route)</code></p>
<p><code>push()</code>æ˜¯æ‰“å¼€é¡µé¢æœ€å¸¸ç”¨çš„æ–¹æ³•ä¹‹ä¸€ã€‚ç¬¬ä¸€ä¸ªå‚æ•°contextæ˜¯ä¸Šä¸‹æ–‡ï¼Œåœ¨StatelessWidgetå’ŒStatefulWidgetä¸­éƒ½èƒ½è·å–åˆ°ï¼›ç¬¬äºŒä¸ªå‚æ•°routeæ˜¯Routeå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†çš„è¢«æ‰“å¼€çš„é¡µé¢ä¿¡æ¯ï¼Œä¸€èˆ¬ä½¿ç”¨<code>MaterialPageRoute</code>ã€‚çœ‹ä¸‹ç”¨æ³•ï¼š</p>
<pre><code>class PushPageA extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return new Scaffold(
        appBar: new AppBar(
          title: new Text(&quot;Page A&quot;),
        ),
        body: new Center(
            child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: &lt;Widget&gt;[
              new RaisedButton(
                  onPressed: () {
                    Navigator.push(context,
                        MaterialPageRoute(builder: (context) {
                          return PushPageB();
                        }));
                },
                child: new Text(&quot;push to B&quot;)),
          ],
        )));
  }
}

class PushPageB extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return new Scaffold(
        appBar: new AppBar(
          title: new Text(&quot;Page B&quot;),
        ),
        body: new Text(&quot;this is page B&quot;));
  }
}
</code></pre>
<p>è¿™æ ·å°±æ‰“å¼€äº†å¦ä¸€ä¸ªé¡µé¢ï¼Œå¾ˆç®€å•å§ï¼ä½†æ˜¯ä¸€ä¸ªç®€å•çš„è·³è½¬å±…ç„¶è¦æˆ‘å†™å››è¡Œä»£ç ï¼Œæˆ‘ä¹Ÿæ˜¯é†‰äº†ã€‚æœ‰æ²¡æœ‰ç®€å•ä¸€ç‚¹çš„å†™æ³•ï¼Œå½“ç„¶æœ‰ï¼š</p>
<pre><code>Navigator.push(context,
    MaterialPageRoute(builder: (context) =&gt; PushPageB()));
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨èƒ–ç®­å¤´è¯­æ³•æŠŠå››è¡Œä»£ç å˜æˆäº†ä¸¤è¡Œï¼Œç›¸å¯¹äºä¸Šé¢çš„è·³è½¬ä»£ç æ¥è¯´æ›´åŠ æ˜“è¯»äº†ã€‚ä½†è¿˜æ˜¯æœ‰ç‚¹å•°å—¦ï¼Œæœ‰æ²¡æœ‰æ›´ç®€ç»ƒçš„è¯­æ³•ã€‚å½“ç„¶æœ‰~</p>
<blockquote>
<p>MaterialPageRouteæ˜¯Routeçš„å­ç±»ï¼Œå®ƒæ˜¯æœ€å¸¸ç”¨çš„æ„å»ºRouteçš„ç±»ã€‚ä¹Ÿå¯ä»¥å¾€æ–¹æ³•é‡Œä¼ å…¥å…¶ä»–çš„Routeå­ç±»ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰Routeã€‚</p>
</blockquote>
<h2 id="pushnamed">pushNamed()</h2>
<p><code>Future&lt;T&gt; pushNamed&lt;T extends Object&gt;(BuildContext context, String routeName)</code></p>
<p><code>pushNamed()</code>æ˜¯ä½¿ç”¨è·¯å¾„åç§°çš„æ–¹å¼æ‰“å¼€é¡µé¢ã€‚ç¬¬äºŒä¸ªå‚æ•°routeNameå°±æ˜¯é¡µé¢çš„è·¯å¾„ã€‚è¦æƒ³ä½¿ç”¨è¿™ç§è·³è½¬æ–¹å¼è¦åˆ†ä¸¤æ­¥èµ°ï¼š1. å®šä¹‰é¡µé¢è·¯å¾„ï¼›2. ä½¿ç”¨é¡µé¢è·¯å¾„è·³è½¬ã€‚</p>
<p>é¦–å…ˆï¼Œå®šä¹‰é¡µé¢è·¯å¾„ã€‚åœ¨åº”ç”¨mainAppçš„build()ä¸­è¿”å›MaterialApp()ï¼Œç„¶ååœ¨MaterialApp()çš„<em>routes</em>å±æ€§ä¸­å®šä¹‰è·¯å¾„å¹¶ç»™è·¯å¾„èµ‹å€¼ï¼Œé¡µé¢è·¯å¾„è¦ä½¿ç”¨<code>â€˜/a/b/câ€™</code>è¿™æ ·çš„æ ¼å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨ä¸»é¡µé¢çš„è·¯å¾„æ˜¯â€/â€œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<em>initialRoute</em>ä¿®æ”¹ä¸»é¡µé¢è·¯å¾„ï¼Œä¸è¿‡æ²¡å•¥ä¿®æ”¹çš„å¿…è¦ã€‚OKï¼Œä¸Šä»£ç ï¼š</p>
<pre><code>void main() =&gt; runApp(new MyApp());

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return new MaterialApp(
      theme: new ThemeData(
        primarySwatch: Colors.brown,
      ),
//      home: new MyHomePage(title: 'Navigation Demo'),
      routes: {
        &quot;/&quot;: (context) =&gt; new MyHomePage(title: 'Navigation Demo'),
        &quot;/page2&quot;: (context) =&gt; new Page2(),
      },
    );
  }
}
</code></pre>
<p>è¿™æ ·å°±å®šä¹‰å¥½è·¯å¾„ï¼Œåé¢å°±å¯ä»¥ä½¿ç”¨å®ƒä»¬è¿›è¡Œè·³è½¬ã€‚ä½†æ˜¯æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚</p>
<ol>
<li>ä¸Šé¢çš„ä»£ç æ³¨é‡Šäº†<em>home</em>å±æ€§ï¼Œ<em>route</em>å±æ€§ä¸­<code>&quot;/&quot;: (context) =&gt; new MyHomePage()</code>è¿™è¡Œä»£ç æŒ‡å®šäº†ä¸»ç•Œé¢æ˜¯MyHomePageã€‚å¦‚æœä»¬åœ¨<em>route</em>ä¸­å³ä½¿ç”¨äº†â€/â€œæŒ‡å®šä¸»é¡µé¢ï¼Œåˆä½¿ç”¨äº†<em>home</em>å±æ€§ï¼Œè¿™æ—¶è¿è¡Œåº”ç”¨æ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸çš„ã€‚<em>home</em>å’Œ<em>route</em>ä¸­çš„â€/â€œåªèƒ½é€‰æ‹©ä¸€ä¸ªã€‚</li>
<li>æˆ‘èƒ½ä¸èƒ½åœ¨å…¶ä»–é¡µé¢çš„<code>build()</code>ä¸­åˆ›å»ºä¸€ä¸ªMaterialApp()ï¼Œåœ¨è¿™ä¸ªé¡µé¢çš„<em>route</em>å±æ€§ä¸­å®šä¹‰è·¯å¾„å¯ä»¥å—ï¼Ÿä¸å¯ä»¥ï¼Œåªèƒ½åœ¨<code>main()</code>çš„MaterialApp()ä¸­å®šä¹‰ã€‚å¦‚æœåœ¨å…¶ä»–é¡µé¢çš„MaterialApp()ä¸­å®šä¹‰äº†è·¯å¾„ï¼Œç„¶åæ‰§è¡Œ<code>pushName()</code>è¿›è¡Œè·³è½¬ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼šAnother exception was thrown: Could not find a generator for route â€œ/routeNameâ€ in the _WidgetsAppStateã€‚</li>
</ol>
<p>ç°åœ¨å°±å¯ä»¥ä½¿ç”¨pushNamed()è¿›è¡Œè·³è½¬äº†ï¼š</p>
<pre><code>Â·Â·Â·
Navigator.pushNamed(context, &quot;/page2&quot;);
Â·Â·Â·
</code></pre>
<p><code>pushNamed()</code>ç”¨æ³•æ¯”è¾ƒç®€å•ç›´è§‚ï¼Œè™½ç„¶è¦é…ç½®è·¯å¾„ï¼Œä½†ä¹Ÿæ˜¯ä¸€åŠ³æ°¸é€¸çš„äº‹æƒ…ã€‚</p>
<h2 id="pop">pop()</h2>
<p><code>bool pop&lt;T extends Object&gt;(BuildContext context, [ T result ])</code></p>
<p>ç›´æ¥è°ƒç”¨<code>pop(context)</code>å³å¯å…³é—­é¡µé¢ã€‚åœ¨<em>initialRoute</em>é¡µé¢ï¼Œä¹Ÿå°±æ˜¯ä¸»é¡µé¢è°ƒç”¨<code>pop(context)</code>ä¼šæ˜¾ç¤ºç©ºç™½é¡µé¢ï¼ˆä¸€äº›æœºå‹ä¼šæ˜¾ç¤ºå…¨é»‘çš„é¡µé¢ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€äº›ç•Œé¢å¯ä»¥è°ƒç”¨<code>pop(context)</code>ï¼Œä¸€äº›ç•Œé¢ä¸å¯ä»¥ã€‚é‚£æˆ‘ä»¬æ€ä¹ˆåˆ¤æ–­åœ¨å½“å‰é¡µé¢èƒ½ä¸èƒ½è°ƒç”¨<code>pop(context)</code>å‘¢ï¼Ÿ</p>
<h2 id="canpop">canPop()</h2>
<p><code>bool canPop(BuildContext context)</code></p>
<p>canPop()è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå‘Šè¯‰è°ƒç”¨è€…å½“å‰é¡µé¢æ˜¯å¦å¯ä»¥è°ƒç”¨<code>pop(context)</code>ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›falseçš„æƒ…å†µæœ‰ä¸¤ç§ï¼š</p>
<ol>
<li><em>initialRoute</em>ï¼Œè¢«æ ‡è®°ä¸º<em>initialRoute</em>çš„é¡µé¢ä¸èƒ½æ‰§è¡Œpop()ã€‚åœ¨è¿™ä¸ªé¡µé¢æ‰§è¡Œpop()è¦ä¹ˆæŠ¥é”™ï¼Œè¦ä¹ˆæ˜¾ç¤ºä¸€ä¸ªç©ºç™½é¡µé¢ã€‚</li>
<li>åœ¨å½“å‰çš„ä¸Šä¸‹æ–‡é‡Œæ²¡æœ‰Navigatorçš„æ—¶å€™ä¼šè¿”å›falseã€‚</li>
</ol>
<h2 id="maybepop">maybePop()</h2>
<p><code>maybePop&lt;T extends Object&gt;(BuildContext context, [ T result ])</code></p>
<p>åœ¨<em>initialRoute</em>é¡µé¢æ‰§è¡Œpop()ä¼šæ˜¾ç¤ºç©ºç™½é¡µé¢ï¼Œæˆ–è€…æŠ¥é”™ã€‚æˆ‘ä»¬ä¸èƒ½åœ¨è¿™ä¸ªé¡µé¢æ‰§è¡Œpop()ã€‚å¦‚æœä¸ç¡®å®šåœ¨æŸä¸ªé¡µé¢èƒ½ä¸èƒ½æ‰§è¡Œpop()ã€‚å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹å†æ‰§è¡Œï¼š</p>
<pre><code>if(Navigator.canPop(context)){
    Navigator.pop(context);
}
</code></pre>
<p><code>maybePop()</code>åœ¨å†…éƒ¨å¸®åŠ©æˆ‘ä»¬åšäº†åˆ¤æ–­ã€‚å½“å‰é¡µé¢å¦‚æœå¯ä»¥è¢«popå°±æ‰§è¡Œ<code>pop()</code>ï¼Œå¦‚æœä¸å¯ä»¥å°±ä¸æ‰§è¡Œã€‚æˆ‘ä»¬åœ¨<em>initialRoute</em>é¡µé¢æ‰§è¡Œè¿™ä¸ªæ–¹æ³•æ˜¯æ²¡æœ‰ä»»ä½•è¡¨ç°çš„ï¼Œåœ¨å…¶ä»–é¡µé¢æ‰§è¡Œä¼šæ­£å¸¸å…³é—­å½“å‰é¡µé¢ã€‚</p>
<h2 id="å…³é—­é¡µé¢å¹¶è¿”å›å€¼">å…³é—­é¡µé¢å¹¶è¿”å›å€¼</h2>
<p>Androidé‡Œé¢çš„<code>startActivityForResult()</code>ï¼Œæ¬¡çº§é¡µé¢å®Œæˆåå…³é—­ï¼Œç„¶åå¾€ä¸€çº§é¡µé¢è¿”å›å€¼ã€‚Flutterä¸­ä¹Ÿæœ‰å¯¹åº”çš„æœºåˆ¶ã€‚æˆ‘ä»¬å†çœ‹ä¸€ä¸‹pop()ï¼š</p>
<pre><code>bool pop&lt;T extends Object&gt;(BuildContext context, [ T result ])
</code></pre>
<p>ç¬¬äºŒä¸ªå‚æ•°resultå°±æ˜¯è¿”å›ç»™ä¸Šçº§é¡µé¢çš„å€¼ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ‰“å¼€é¡µé¢çš„ä»£ç ï¼š</p>
<pre><code>static Future&lt;T&gt; push&lt;T extends Object&gt;(BuildContext context, Route&lt;T&gt; route)
</code></pre>
<p>å®ƒçš„è¿”å›å€¼ç±»å‹æ˜¯Future<T>ï¼Œä»–å°±ä»£è¡¨ä»ä¸Šä¸ªé¡µé¢è¿”å›çš„å€¼ï¼Œçœ‹ä¸‹å®Œæ•´çš„ä»£ç ï¼š</p>
<pre><code>// ä¸€çº§é¡µé¢æ‰“å¼€æ¬¡çº§é¡µé¢çš„ä»£ç 
_pushToPage2() async {
    String result = await Navigator.push(
        context, MaterialPageRoute(builder: (context) =&gt; Page2()));
    print(&quot;$tag $result&quot;);
}

//æ¬¡çº§é¡µé¢è¿”å›çš„ä»£ç 
Navigator.pop(context, &quot;è¿™æ˜¯è¿”å›å€¼&quot;);
</code></pre>
<h2 id="é¡µé¢ä¼ å€¼">é¡µé¢ä¼ å€¼</h2>
<p>åœ¨Androidä¸­é€šè¿‡Intentç»™å…¶ä»–é¡µé¢ä¼ å€¼ï¼Œå…ˆåˆ›å»ºIntent()ç„¶åæŠŠIntentä¼ ç»™<code>startActivity()</code>ï¼Œåœ¨ä¸‹ä¸ªé¡µé¢è·å–åˆ°Intentåæ‹¿æ•°æ®ã€‚åœ¨Flutterä¸­è¿™ä¸ªæµç¨‹å°±è¦ç®€å•çš„å¤šï¼Œç›´æ¥æŠŠæ•°æ®æ”¾åˆ°é¡µé¢çš„æ„é€ å‡½æ•°ä¸­ã€‚è¿™ç§æ–¹å¼å°±æ¯”è¾ƒç›´è§‰ç®€å•ã€‚ä»£ç è¿˜ç”¨ä¸Šé¢çš„ä¾‹å­ï¼š</p>
<pre><code>// ä¸€çº§é¡µé¢æ‰“å¼€æ¬¡çº§é¡µé¢çš„ä»£ç 
_pushToPage2() async {
    String result = await Navigator.push(
        context, MaterialPageRoute(builder: (context) =&gt; Page2()));
    print(&quot;$tag $result&quot;);
}

class Page2 extends StatelessWidget {
  String data;
  Page2({Key key, this.data}): super(key: key);

  @override
  Widget build(BuildContext context) {
    return new Scaffold(
      appBar: AppBar(
        title: new Text(&quot;ç¬¬äºŒä¸ªé¡µé¢&quot;),
      ),
      body: new Center(
        child: Column(children: &lt;Widget&gt;[
          new Text(data),
        ],)
      ),
    );
  }
}
</code></pre>
<p>Flutterçš„é¡µé¢ä¼ å€¼å°±ç®€å•ï¼Œä½†ä½¿ç”¨<code>pushNamed()</code>æ˜¯æ²¡æœ‰åŠæ³•è¿›è¡Œä¼ å€¼çš„ã€‚</p>
<p>#android/flutter<br>
#blog</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Handler]]></title>
        <id>http://localhost:4000/post/handler-ji-zhi</id>
        <link href="http://localhost:4000/post/handler-ji-zhi">
        </link>
        <updated>2019-10-27T14:07:22.000Z</updated>
        <summary type="html"><![CDATA[<p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šæˆ‘åœ¨æ·˜å®ä¸‹ä¸ªè®¢å•ï¼Œè®¢å•ä¸ŠåŒ…å«æˆ‘çš„å§“åå’Œåœ°å€ã€è´§ç‰©åç§°ç­‰ï¼Œå•†å®¶æŠŠè®¢å•æ‰“åŒ…åäº¤ç»™é¡ºä¸°ï¼Œé¡ºä¸°æŠŠè®¢å•è¿åˆ°åŒ—äº¬çš„é›†æ•£ä¸­å¿ƒï¼Œé›†æ•£ä¸­å¿ƒæ ¹æ®è®¢å•ä¸Šçš„å§“åå’Œåœ°å€æŠŠè´§ç‰©æ´¾é€ç»™æˆ‘ã€‚è¿™æ˜¯ç½‘è´­çš„æµç¨‹ï¼Œå’ŒHandleræœºåˆ¶æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ï¼š</p>
]]></summary>
        <content type="html"><![CDATA[<p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šæˆ‘åœ¨æ·˜å®ä¸‹ä¸ªè®¢å•ï¼Œè®¢å•ä¸ŠåŒ…å«æˆ‘çš„å§“åå’Œåœ°å€ã€è´§ç‰©åç§°ç­‰ï¼Œå•†å®¶æŠŠè®¢å•æ‰“åŒ…åäº¤ç»™é¡ºä¸°ï¼Œé¡ºä¸°æŠŠè®¢å•è¿åˆ°åŒ—äº¬çš„é›†æ•£ä¸­å¿ƒï¼Œé›†æ•£ä¸­å¿ƒæ ¹æ®è®¢å•ä¸Šçš„å§“åå’Œåœ°å€æŠŠè´§ç‰©æ´¾é€ç»™æˆ‘ã€‚è¿™æ˜¯ç½‘è´­çš„æµç¨‹ï¼Œå’ŒHandleræœºåˆ¶æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ï¼š</p>
<!-- more -->
<ol>
<li>æˆ‘ â€”â€” Handlerï¼Œæˆ‘ä¸‹è®¢å•å°±æ˜¯<code>handler.post()</code>ï¼Œè®¢å•ç»è¿‡è½¬è¿ä¹‹åè¿˜æ˜¯äº¤ç»™æˆ‘ï¼›Handlerå‘æ¶ˆæ¯çš„æœ€ç»ˆç›®çš„åœ°è¿˜æ˜¯Handlerçš„å›è°ƒå¤„ç†æ¶ˆæ¯</li>
<li>è®¢å• â€”â€” Messageï¼Œè®¢å•é‡ŒåŒ…å«æ”¶è´§åœ°å€ï¼Œè´§ç‰©ç­‰ï¼Œå°±æ˜¯<code>msg.target</code>ã€<code>msg.what</code>ã€<code>msg.data</code>ï¼ŒMessageæ˜¯æ¶ˆæ¯ä¼ é€’çš„ä»‹è´¨</li>
<li>é¡ºä¸° â€”â€” MessageQueueï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ï¼ŒMessageQueueå°±æ˜¯æ¬è¿å·¥ï¼Œæ ¹æ®æ¶ˆæ¯çš„æ—¶é—´å…ˆåé¡ºåºåˆ†å‘æ¶ˆæ¯</li>
<li>é›†æ•£ä¸­å¿ƒ â€”â€” Looperï¼Œé›†æ•£ä¸­å¿ƒä¸€ç›´é˜»å¡åœ¨è¿™é‡Œç­‰å¾…æ–°çš„è´§ç‰©åˆ°è¾¾ï¼Œç„¶åæ ¹æ®è®¢å•ä¸Šçš„åœ°å€åˆ†å‘å¿«é€’ï¼›Looperåœ¨forå¾ªç¯é‡Œä¸€ç›´è·å–æœ€æ–°çš„æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ–°æ¶ˆæ¯å°±æ ¹æ®<code>msg.target</code>è·å–åˆ°handlerç„¶åè°ƒç”¨<code>dispatchMessage()</code>æŠŠæ¶ˆæ¯åˆ†å‘ä¸‹å»ï¼Œæœ€åè§¦å‘Handlerçš„Callbackå›è°ƒ</li>
</ol>
<p>è™½ç„¶è¿™ä¸ªä¾‹å­å¹¶æ²¡æœ‰å®Œç¾çš„å¥‘åˆHandlerçš„è¿è¡Œæœºåˆ¶ï¼ˆè¿˜æœ‰å•†å®¶æ²¡æœ‰å¯¹åº”åˆ°Handlerï¼‰ï¼Œä½†æ˜¯å¯¹äºç†è§£Handleræ˜¯ååˆ†æœ‰å¸®åŠ©çš„ã€‚</p>
<p>Handleræ˜¯Androidåº”ç”¨å±‚ä¸­å¹¿æ³›ä½¿ç”¨çš„å¤šçº¿ç¨‹é€šä¿¡ç»„ä»¶ã€‚Handlerçš„ç”¨é€”è¡¨ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼šï¼ˆ1ï¼‰å»¶æ—¶æ‰§è¡ŒRunnableæˆ–å»¶æ—¶å‘é€Messageï¼›ï¼ˆ2ï¼‰çº¿ç¨‹é—´é€šä¿¡ï¼Œç»™å…¶ä»–çº¿ç¨‹å‘æ¶ˆæ¯ï¼Œé€šçŸ¥å…¶ä»–çº¿ç¨‹æ‰§è¡Œæ“ä½œã€‚</p>
<p>æ•´ä¸ªHandleræœºåˆ¶åŒ…å«å››ä¸ªè§’è‰²ï¼š</p>
<ul>
<li><code>Handler</code>ï¼Œå®ƒæ˜¯å¼€å‘è€…ç›´æ¥æ“ä½œçš„å¯¹è±¡ï¼Œå®ƒå‚ä¸äº†æ¶ˆæ¯åˆ†å‘æµç¨‹ä¸­å‘é€å’Œå¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹</li>
<li><code>Message</code>ï¼Œæ˜¯æ¶ˆæ¯ä¼ é€’çš„ä»‹è´¨ï¼Œä¼ é€’çš„æ•°æ®è¦åŒ…è£…æˆMessage</li>
<li><code>MessageQueue</code>ï¼Œå¼€å‘è€…å‡ ä¹æ— æ³•æ¥è§¦ï¼Œå®ƒæ“ä½œäº†æ¶ˆæ¯çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿ</li>
<li><code>Looper</code>ï¼Œæ¶ˆæ¯åˆ†å‘çš„æ ¸å¿ƒï¼Œæ•´ä¸ªæµç¨‹çš„å¿ƒè„</li>
</ul>
<p>Androidé¢è¯•ç»å¸¸ä¼šé—®Handlerï¼Œè™½ç„¶è¿™æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œä½†çœŸæ­£ææ˜ç™½è¿˜æ˜¯è¦èŠ±è´¹ä¸€ç•ªåŠŸå¤«ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>Handlerçš„è¿è¡Œæœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</li>
<li>å­çº¿ç¨‹ä¸­å¯ä»¥ç›´æ¥åˆ›å»ºHandlerå—ï¼Ÿ</li>
<li>å®˜æ–¹æ–‡æ¡£ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨Message.obtain()åˆ›å»ºMessageï¼Ÿ</li>
<li>Handleræ˜¯æ€ä¹ˆé€ æˆå†…å­˜æ³„æ¼çš„ï¼Ÿåœ¨Activityä¸­åˆ›å»ºHandleræˆå‘˜å˜é‡ä¸€å®šä¼šé€ æˆå†…å­˜æ³„æ¼å—ï¼Ÿ</li>
</ol>
<p>æœ¬æ–‡ä¼šä¸€ä¸€è§£ç­”ä¸Šé¢çš„é—®é¢˜ã€‚ç°åœ¨å…ˆä¾æ¬¡ä»‹ç»Handlerçš„å››ä¸ªè§’è‰²ï¼Œä»‹ç»å®ŒHandlerçš„æ•´ä¸ªè¿è¡Œæœºåˆ¶å°±ä¼šå¾ˆæ¸…æ™°ã€‚</p>
<h2 id="handler">Handler</h2>
<p>Handlerè´Ÿè´£å‘é€å’Œå¤„ç†Messageã€‚åœ¨å“ªä¸ªçº¿ç¨‹åˆ›å»ºHandlerï¼Œå®ƒå°±å±äºå“ªä¸ªçº¿ç¨‹ï¼›æ¯”å¦‚ï¼Œåœ¨Activityä¸­åˆ›å»ºHandlerå®ä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªHandlerå°±å’Œä¸»çº¿ç¨‹ç»‘å®šäº†ã€‚å½“ç„¶ï¼Œåœ¨Activityä¸­åˆ›å»ºHandlerçš„åŒ¿åå†…éƒ¨ç±»å˜é‡å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼</p>
<p>é€šè¿‡æ–¹æ³•åå’Œå‚æ•°å¯ä»¥æŠŠHandlerçš„å‘é€æ“ä½œåˆ†ä¸ºä¸¤ä¸ªç³»åˆ—ï¼š</p>
<ol>
<li><code>post()</code>ç³»åˆ—æ–¹æ³•ï¼Œå®ƒæ˜¯ç”¨æ¥å‘é€Runnableå¯¹è±¡åˆ°MessageQueueä¸­ã€‚å¦‚ï¼Œ<code>post(Runnable r)</code>ã€<code>postAtTime(Runnable r, long uptimeMillis)</code>ã€<code>postDelayed(Runnable r, long delayMillis)</code>ç­‰</li>
<li><code>send()</code>ç³»åˆ—æ–¹æ³•ï¼Œå®ƒæ˜¯ç”¨æ¥å‘é€Messageå¯¹è±¡åˆ°MessageQueueä¸­ã€‚å¦‚ï¼Œ<code>sendMessage(Message msg)</code>ã€<code>sendMessageAtTime(Message msg, long uptimeMillis)</code>ã€<code>sendMessageDelayed(Message msg, long delayMillis)</code>ç­‰<br>
è¿™ä¸¤ä¸ªç³»åˆ—çš„æ–¹æ³•åˆ†åˆ«ç”¨æ¥å‘é€å’Œå¤„ç†Runnableå’ŒMessageå¯¹è±¡ï¼›Runnableåœ¨Handlerä¸­ä¹Ÿä¼šè¢«åŒ…è£…æˆMessageå‘é€ç»™MessageQueueã€‚</li>
</ol>
<h3 id="åˆ›å»º">åˆ›å»º</h3>
<p>Handleræä¾›äº†å¤šä¸ªæ„é€ å‡½æ•°ï¼Œåˆ›å»ºHandleræœ€å¸¸ç”¨çš„æ„é€ å‡½æ•°æ˜¯ï¼š</p>
<pre><code>public Handler(@Nullable Callback callback) {
    this(callback, false);
}

public Handler(@Nullable Callback callback, boolean async) {
    â€¦çœç•¥ä»£ç â€¦
    mLooper = Looper.myLooper();
    if (mLooper == null) {
        throw new RuntimeException(
            â€œCanâ€™t create handler inside thread â€œ + Thread.currentThread()
                    + â€œ that has not called Looper.prepare()â€);
    }
    mQueue = mLooper.mQueue;
    mCallback = callback;
    mAsynchronous = async;
}
</code></pre>
<p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼ŒHandlerè·å–äº†mLooperå’ŒmQueueçš„å®ä¾‹ã€‚è¿™ä¹Ÿè¯´æ˜äº†ï¼ŒHandlerå’ŒLooperç»‘å®šï¼ŒHandlerå”¯ä¸€å¯¹åº”ä¸€ä¸ªLooperï¼ŒLooperè¿è¡Œåœ¨å“ªä¸ªçº¿ç¨‹Handlerå°±å±äºå“ªä¸ªçº¿ç¨‹ã€‚</p>
<p>::å­çº¿ç¨‹ä¸­å¯ä»¥ç›´æ¥åˆ›å»ºHandlerå—ï¼Ÿ::<br>
â€ä¸å¯ä»¥ï¼Œä¼šæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œéœ€è¦å…ˆè°ƒç”¨<code>Looper.prepare()</code>ã€‚â€å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ­£ç¡®ä½†ä¸ä¸¥è°¨çš„å›ç­”ã€‚</p>
<pre><code>	val runnable = Runnable {  Handler()  }
  Thread(runnable).start()
</code></pre>
<p>è¿è¡Œä¸Šé¢çš„ä»£ç ä¼šæŠ¥é”™ï¼š<code>java.lang.RuntimeException: Can't create handler inside thread Thread[Thread-2,5,main] that has not called Looper.prepare()</code>ã€‚å­çº¿ç¨‹æ²¡æœ‰è¿è¡ŒLooperã€‚</p>
<p>ç¡®å®šä¸å¯ä»¥åœ¨å­çº¿ç¨‹ç›´æ¥åˆ›å»ºHandlerå—ï¼Ÿå½“ç„¶å¯ä»¥ã€‚Handleræä¾›äº†ä¸‹é¢çš„æ„é€ å‡½æ•°ï¼š</p>
<pre><code>public Handler(@NonNull Looper looper, @Nullable Callback callback) {
    this(looper, callback, false);
}
</code></pre>
<p>ç»™Handlerçš„æ„é€ å‡½æ•°ä¼ Looperï¼ŒHandlerä¼šç»‘å®šåˆ°Looperè¿è¡Œçš„çº¿ç¨‹ï¼š</p>
<pre><code>val runnable = Runnable {
		val handler = Handler(Looper.getMainLooper())
		handler.post { //æ›´æ–°UI }
}
Thread(runnable).start()
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„<code>handler</code>è¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œ<code>handler.post(Runnable)</code>å°±å¯ä»¥åœ¨è¯¥Runnableä¸­ç›´æ¥å¯¹UIè¿›è¡Œæ›´æ–°ã€‚</p>
<p>å­çº¿ç¨‹åˆ›å»ºHandlerçš„å¦ä¸€ä¸ªæ›´é€šç”¨çš„æ–¹æ³•æ˜¯è°ƒç”¨<code>Looper.prepare()</code>ï¼Œå…ˆè®©å­çº¿ç¨‹è¿è¡ŒLooperï¼š</p>
<pre><code>	val runnable = Runnable {
		Looper.prepare()
		Looper.loop()
      val rHandler = Handler()
  }
  Thread(runnable).start()
</code></pre>
<p><code>rHandler</code>æ˜¯å­çº¿ç¨‹çš„Handler()ï¼Œå…¶ä»–çº¿ç¨‹è·å–åˆ°<code>rHandler</code>å°±å¯ä»¥ç»™å®ƒå‘é€Messageå’ŒRunnableï¼Œå®ç°çº¿ç¨‹é—´é€šä¿¡ã€‚</p>
<p>å›åˆ°ä¸Šé¢çš„é—®é¢˜ï¼Œ::å­çº¿ç¨‹ä¸­å¯ä»¥ç›´æ¥åˆ›å»ºHandlerå—ï¼Ÿ:: å­çº¿ç¨‹åˆ›å»ºHandleræœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>æœ€å¸¸ç”¨çš„æ–¹å¼æ˜¯å…ˆè°ƒç”¨<code>Looper.prepare()</code>å’Œ<code>Looper.loop()</code>è®©å­çº¿ç¨‹è¿è¡ŒLooperï¼Œç„¶åå†åˆ›å»ºHandlerï¼›å¦‚æœå­çº¿ç¨‹å·²ç»è¿è¡Œäº†Looperï¼Œé‚£å°±å¯ä»¥ç›´æ¥åˆ›å»ºHandlerã€‚é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„Handleræ˜¯è¿è¡Œåœ¨å­çº¿ç¨‹çš„ã€‚</li>
<li>å¯ä»¥é€šè¿‡<code>Handler(Looper looper)</code>åœ¨å­çº¿ç¨‹åˆ›å»ºHandlerã€‚é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„Handlerå’Œå‚æ•°ä¸­looperè¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼›æ¯”å¦‚ï¼Œåœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨<code>Handler(Looper.getMainLooper())</code>ï¼Œåˆ›å»ºçš„Handleræ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„ã€‚</li>
</ol>
<h3 id="æ¶ˆæ¯å…¥é˜Ÿ">æ¶ˆæ¯å…¥é˜Ÿ</h3>
<p><code>post()</code>ç³»åˆ—æ–¹æ³•ä¼šå…ˆè°ƒç”¨<code>getPostMessage(Runnable r)</code>æŠŠRunnableåŒ…è£…æˆMessageï¼Œç„¶åå†è¿›è¡Œå…¥é˜Ÿæ“ä½œï¼š</p>
<pre><code>public final boolean post(@NonNull Runnable r) {
   return  sendMessageDelayed(getPostMessage(r), 0);
}

public final boolean postAtTime(@NonNull Runnable r, long uptimeMillis) {
    return sendMessageAtTime(getPostMessage(r), uptimeMillis);
}

public final boolean postDelayed(@NonNull Runnable r, long delayMillis) {
    return sendMessageDelayed(getPostMessage(r), delayMillis);
}

private static Message getPostMessage(Runnable r) {
    Message m = Message.obtain();
    m.callback = r;
    return m;
}
</code></pre>
<p><code>post()</code>å’Œ<code>send()</code>ç›¸å…³æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè°ƒç”¨<code>enqueueMessage()</code>ï¼š</p>
<pre><code>private boolean enqueueMessage(@NonNull MessageQueue queue, @NonNull Message msg, long uptimeMillis) {
    msg.target = this;
    msg.workSourceUid = ThreadLocalWorkSource.getUid();

    if (mAsynchronous) {
        msg.setAsynchronous(true);
    }
    return queue.enqueueMessage(msg, uptimeMillis);
}
</code></pre>
<ul>
<li><code>queue</code>æ˜¯Handlerä¸­çš„å…¨å±€å˜é‡mQueueå®ä¾‹</li>
<li><code>msg</code>æ˜¯è¢«å‘é€çš„æ¶ˆæ¯å®ä¾‹ï¼Œ<code>uptimeMillis</code>æ˜¯å»¶æ—¶çš„æ¯«ç§’å€¼</li>
<li><code>msg.target</code>æ˜¯å¤„ç†è¿™ä¸ªMessageçš„Handler</li>
</ul>
<p>è°ƒç”¨<code>queue.enqueueMessage</code>æŠŠMessageæäº¤ç»™MessageQueueï¼Œå…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œåœ¨MessageQueueä¸­è¿›è¡Œã€‚</p>
<p>æœ€åæ€»ç»“ä¸€ä¸‹Handlerï¼šHandlerç”¨äºå‘é€å’Œå¤„ç†æ¶ˆæ¯ï¼ŒHandleræŠŠMessageè½¬å‘ç»™MessageQueueè¿›è¡Œå…¥é˜Ÿæ“ä½œï¼›å®ƒæŒæœ‰Looperå’ŒMessageQueueçš„å®ä¾‹ï¼ŒHandlerå”¯ä¸€å¯¹åº”äº†ä¸€ä¸ªLooperå’ŒMessageQueueï¼ŒLooperå±äºå“ªä¸ªçº¿ç¨‹ï¼ŒHandlerå°±å±äºå“ªä¸ªçº¿ç¨‹ã€‚</p>
<h2 id="message">Message</h2>
<p>Messageæ˜¯çº¿ç¨‹é—´ä¼ é€’çš„ä»‹è´¨ï¼Œå®ƒåŒ…å«æ¶ˆæ¯å†…å®¹å’Œç±»å‹ï¼›å®ƒæ˜¯ä¸€ä¸ªç®€å•çš„é“¾è¡¨ç»“æ„ï¼ŒåªåŒ…å«<code>next</code>èŠ‚ç‚¹ï¼Œpopå’Œpushéƒ½æ˜¯ç”±MessageQueueå®Œæˆçš„ã€‚</p>
<pre><code>public final class Message implements Parcelable {
    public int what;
    public int arg1;
    public int arg2;
    public Object obj;
    Bundle data;
    Handler target;
    Runnable callback;

    // sometimes we store linked lists of these things
    Message next;
}
</code></pre>
<ul>
<li><code>what</code>æ˜¯æ¶ˆæ¯ç±»å‹</li>
<li><code>arg1</code>ã€<code>arg2</code>ã€<code>data</code>ã€<code>obj</code>ç”¨æ¥å­˜æ”¾æ¶ˆæ¯å†…å®¹</li>
<li><code>target</code>æ˜¯å¤„ç†Messageçš„Handlerå¼•ç”¨</li>
<li><code>callback</code>æ˜¯Runnableç±»å‹ï¼Œå¦‚æœHandlerä½¿ç”¨äº†<code>post(Runnable)</code>ç³»åˆ—æ–¹æ³•ï¼ŒRunnableåœ¨å…¥é˜Ÿä¹‹å‰ä¼šè¢«åŒ…è£…æˆMessageï¼Œ<code>callback</code>å°±æ˜¯Runnableçš„å¼•ç”¨</li>
<li><code>next</code>æ˜¯ä¸‹ä¸€ä¸ªMessageèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå¦‚æœä¸€ä¸ªHandlerå‘é€äº†å¤šä¸ªæ¶ˆæ¯MessageQueueé‡Œé¢æŒæœ‰çš„æ˜¯Messageé“¾è¡¨çš„å¤´èŠ‚ç‚¹</li>
</ul>
<p>Messageé‡Œé¢æœ‰è‹¥å¹²ä¸ªé™æ€çš„é‡è½½<code>obtain()</code>ï¼Œå®ƒä»¬éƒ½æ˜¯ç”¨æ¥åˆ›å»ºMessageçš„ã€‚</p>
<p>::å®˜æ–¹æ–‡æ¡£ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨Message.obtain()åˆ›å»ºMessageï¼Ÿ::<br>
è¿™ä¸ªé—®é¢˜åœ¨<code>obtain()</code>çš„æ³¨é‡Šé‡Œé¢è¯´çš„å¾ˆæ¸…æ¥šï¼š</p>
<pre><code>/**
 * Return a new Message instance from the global pool. Allows us to
 * avoid allocating new objects in many cases.
 */
public static Message obtain() {
}
</code></pre>
<p>åº”ç”¨ä¸­æœ‰å…¨å±€çš„Messageå®ä¾‹æ± ï¼Œåˆ›å»ºMessageæ—¶è°ƒç”¨<code>obtain()</code>ä¼šä»æ± é‡Œé¢è·å–Messageå®ä¾‹ï¼Œç”¨å®Œåé€šè¿‡Messageçš„<code>recycler()</code>å›æ”¶åˆ°æ± ä¸­ï¼Œä»è€Œé¿å…äº†åˆ†é…è¿‡å¤šçš„Messageè€Œå ç”¨å†…å­˜ã€‚å’Œçº¿ç¨‹æ± çš„é“ç†æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä¸ºäº†ä¿ƒè¿›èµ„æºå›æ”¶å’Œå……åˆ†åˆ©ç”¨ï¼Œé¿å…åº”ç”¨å ç”¨è¿‡å¤šçš„å†…å­˜èµ„æºã€‚</p>
<blockquote>
<p>Messageçš„å›æ”¶æ˜¯MessageQueueæ“ä½œçš„ï¼Œæ— éœ€å¼€å‘è€…å‚ä¸</p>
</blockquote>
<h2 id="messagequeue">MessageQueue</h2>
<p>Queueæ˜¯é˜Ÿåˆ—ï¼ŒMessageQueueå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚MessageQueueä¸­æœ‰<code>enqueueMessage()</code>å’Œ<code>next()</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œã€‚Handleré€šè¿‡<code>enqueueMessage()</code>æŠŠMessageæ”¾è¿›æ¶ˆæ¯é˜Ÿåˆ—ï¼›Looperé€šè¿‡<code>next()</code>è·å–éœ€è¦è¢«å¤„ç†çš„Messageã€‚</p>
<p>Queueï¼Œé˜Ÿåˆ—åƒæ˜¯ä¸ªä¼ é€å¸¦ï¼›å…ˆæ”¾ä¸Šä¼ é€å¸¦çš„è´§ç‰©å…ˆå‡ºå»ï¼Œåæ”¾ä¸Šå»çš„åå‡ºå»ã€‚MessageQueue çš„å‡ºé˜Ÿé¡ºåºå¹¶æ²¡æœ‰éµå¾ªå…¥é˜Ÿé¡ºåºï¼Œè€Œæ˜¯ä¾æ®å»¶è¿Ÿçš„æ—¶é—´ï¼›å…ˆåˆ°æ—¶é—´çš„å…ˆå‡ºå»ï¼Œååˆ°æ—¶é—´çš„åå‡ºå»ï¼›è€Œå»¶è¿Ÿæ—¶é—´ç›¸åŒçš„Messageæ˜¯ä¾æ®å…¥é˜Ÿé¡ºåºå‡ºé˜Ÿçš„ã€‚</p>
<h2 id="looper">Looper</h2>
<p>Looperé€šè¿‡åç§°å°±å¯ä»¥çœ‹å‡ºæ¥å®ƒçš„ä½œç”¨æ˜¯å¾ªç¯è·å–æ¶ˆæ¯ã€‚LooperæŒæœ‰Threadå’ŒMessageQueueçš„å¼•ç”¨ï¼Œ Threadæ˜¯Looperæ‰€åœ¨çš„çº¿ç¨‹ï¼ŒMessageQueueæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚å¯åŠ¨Looperåªèƒ½é€šè¿‡<code>Looper.prepare()</code>ï¼š</p>
<pre><code>public static void prepare() {
    prepare(true);
}

private static void prepare(boolean quitAllowed) {
    if (sThreadLocal.get() != null) {
        throw new RuntimeException(â€œOnly one Looper may be created per threadâ€);
    }
    sThreadLocal.set(new Looper(quitAllowed));
}

private Looper(boolean quitAllowed) {
    mQueue = new MessageQueue(quitAllowed);
    mThread = Thread.currentThread();
}
</code></pre>
<p>Looperä¸­çš„Threadæ˜¯è·å–äº†å½“å‰çº¿ç¨‹çš„å¼•ç”¨ï¼ŒMessageQueueæ˜¯newå‡ºæ¥çš„ã€‚åŒä¸€ä¸ªçº¿ç¨‹åªèƒ½è°ƒç”¨ä¸€æ¬¡<code>Looper.prepare()</code>ï¼Œå¤šäºä¸€æ¬¡å°±ä¼šæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚<code>sThreadLocal</code>æ˜¯çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œç»“æ„ç±»ä¼¼Mapï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨å’Œå½“å‰çº¿ç¨‹ç›¸å…³çš„å˜é‡ã€‚</p>
<p>Looperä¸­æœ€æ ¸å¿ƒçš„æ˜¯<code>loop()</code>ï¼š</p>
<pre><code>public static void loop() {
    final Looper me = myLooper();                // 1
    if (me == null) {
        throw new RuntimeException(â€œNo Looper; Looper.prepare() wasnâ€™t called on this thread.â€);
    }
    final MessageQueue queue = me.mQueue;       // 2

    for (;;) {
        Message msg = queue.next();             // 3
        if (msg == null) {
            // No message indicates that the message queue is quitting.
            return;
        }

        try {
            msg.target.dispatchMessage(msg);   // 4
        } catch (Exception exception) {
            throw exception;
        } finally {
            ......
        }
    	  ......
    }
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç æ˜¯æç®€ç‰ˆæœ¬ï¼Œçœç•¥äº†å¾ˆå¤šã€‚</p>
<ol>
<li>è·å–å½“å‰çº¿ç¨‹çš„Looperï¼Œé€šè¿‡ThreadLocalå­˜å‚¨Threadå¯¹è±¡å’Œå¯¹åº”çš„Looperï¼Œè·å–çš„æ—¶å€™æ˜¯æ ¹æ®å½“å‰çº¿ç¨‹è·å–çš„</li>
<li>è·å–åˆ°å½“å‰çº¿ç¨‹çš„MessageQueue</li>
<li>è·å–MessageQueueä¸­çš„Messageï¼Œå¦‚æœMessageä¸ºnullï¼Œå°±è¿”å›ï¼Œå¼€å¯ä¸‹æ¬¡å¾ªç¯</li>
<li>è°ƒç”¨Messageçš„target.dispatchMessage(msg)ï¼ŒæŠŠMessageäº¤ç»™è¿™ä¸ªHandler</li>
</ol>
<p>ç°åœ¨æ¥åˆ°äº†æ¶ˆæ¯åˆ†å‘çš„æœ€åä¸€å…¬é‡Œï¼ŒHandlerå‘é€çš„æ¶ˆæ¯ï¼Œæœ€åè¿˜æ˜¯è¦äº¤ç»™Handlerå¤„ç†ï¼Œè§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚</p>
<pre><code>public void dispatchMessage(@NonNull Message msg) {
    if (msg.callback != null) {
        handleCallback(msg);
    } else {
        if (mCallback != null) {
            if (mCallback.handleMessage(msg)) {
                return;
            }
        }
        handleMessage(msg);
    }
}
</code></pre>
<p><code>msg.callback</code>æ˜¯ä»€ä¹ˆï¼Ÿä½¿ç”¨<code>handler.post()</code>å‘é€Runnableï¼Œåœ¨å…¥é˜Ÿä¹‹å‰Runnableä¼šè¢«åŒ…è£…æˆMessageï¼Œå®ƒä¼šèµ‹å€¼ç»™<code>msg.callback</code>ï¼›å¦‚æœä½¿ç”¨äº†<code>post()</code>ç³»åˆ—æ–¹æ³•ï¼Œ<code>msg.callback</code>ä¸€å®šä¸ä¼šä¸ºç©ºï¼Œä»è€Œä¼šè§¦å‘<code>handleCallback(msg)</code>ï¼š</p>
<pre><code>private static void handleCallback(Message message) {
    message.callback.run();
}
</code></pre>
<p>å¦‚æœä½¿ç”¨<code>handler.send()</code>å‘é€Messageï¼Œä¼šèµ°<code>else</code>ï¼›<code>mCallback</code>æ˜¯åˆ›å»ºHandlerä¼ ç»™æ„é€ å‡½æ•°çš„<code>Callback</code>å›è°ƒï¼Œç„¶åè§¦å‘<code>handleMessage(msg)</code>ã€‚æˆ‘çš„å¿«é€’åˆ°äº†ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Handlerçš„æ•´ä½“æµç¨‹å°±å·²ç»å¾ˆæ¸…æ™°äº†ï¼š</p>
<ol>
<li>ä¸»çº¿ç¨‹é€šè¿‡<code>Handler(Callback)</code>åˆ›å»ºHandlerï¼Œåœ¨Callbackä¸­å¤„ç†æ¶ˆæ¯</li>
<li>è°ƒç”¨<code>handler.post(Runnable)</code>æˆ–è€…<code>handler.send()</code>å‘é€æ¶ˆæ¯ï¼ŒRunnableä¼šè¢«åŒ…è£…æˆMessageå‘é€å‡ºå»</li>
<li>åœ¨Handlerä¸­ï¼Œé€šè¿‡<code>queue.enqueueMessage()</code>æŠŠMessageäº¤ç»™MessageQueueè¿›è¡Œå…¥é˜Ÿæ“ä½œ</li>
<li>LooperæŒæœ‰MessageQueueçš„å¼•ç”¨ï¼ŒLooperä¸€ç›´åœ¨ç­‰å¾…MessageQueueä¸­çš„æ–°æ¶ˆæ¯ï¼Œä¸€æ—¦è·å–åˆ°æ–°æ¶ˆæ¯ï¼ŒLooperå–å‡ºMessageä¸­çš„targetï¼Œè°ƒç”¨<code>target.dispatchMessage()</code>ï¼Œæ¶ˆæ¯æœ€åè¢«åˆ†å‘ç»™Handlerçš„Callbackï¼Œæ•´ä¸ªæµç¨‹å°±èµ°å®Œäº†</li>
</ol>
<p>ç°åœ¨å†çœ‹æ–‡ç« æœ€å¼€å§‹çš„ä¾‹å­ï¼Œåº”è¯¥èƒ½ç†è§£Handlerçš„ç²¾é«“äº†ã€‚å†ä¸Šä¸€å¼ å›¾ï¼š</p>
<h2 id="å†…å­˜æ³„æ¼">å†…å­˜æ³„æ¼</h2>
<p>æœ€åå†æƒ³ä¸€ä¸ªé—®é¢˜ï¼ŒHandleræ€ä¹ˆé€ æˆå†…å­˜æ³„éœ²çš„ï¼Œä»¥åŠå¦‚ä½•é¿å…ã€‚</p>
<p>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ<br>
ç»™å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´åï¼Œä¸å†ä½¿ç”¨è¯¥å¯¹è±¡æ—¶ï¼ŒGCä¹Ÿæ— æ³•é‡Šæ”¾å®ƒå ç”¨çš„ç©ºé—´ã€‚æ¯”å¦‚ï¼Œåœ¨Androidä¸­ï¼Œç»“æŸæ‰Activityåï¼ŒActivityå ç”¨çš„å†…å­˜ç©ºé—´æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œè¿™æ—¶Activityå°±å‘ç”Ÿäº†å†…å­˜æ³„æ¼ã€‚</p>
<p>Handlerå‘ç”Ÿå†…å­˜æ³„æ¼çš„ä»£ç é€šå¸¸å¦‚å›¾æ‰€ç¤ºï¼š<br>
[image:B71C376B-2D54-4E29-8DDE-520E0DFD053E-720-000131948978DBD6/35FE30F1-3604-45F2-9248-D9E8704A3CE3.png]<br>
ç¼–è¯‘å™¨çš„æç¤ºå¾ˆå§”å©‰ï¼š<code>leaks might occur</code>ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ³„æ¼ï¼›æ‰€ä»¥ä½¿ç”¨å†…éƒ¨ç±»å½¢å¼çš„Handlerå¹¶ä¸ä¸€å®šä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚</p>
<p>åŒ¿åå†…éƒ¨ç±»HandleræŒæœ‰Activityçš„å¼•ç”¨ï¼ŒMessageæŒæœ‰Handlerçš„å¼•ç”¨ï¼ŒMessageQueueæŒæœ‰Messageçš„å¼•ç”¨ï¼ŒLooperæŒæœ‰MessageQueueçš„å¼•ç”¨ï¼š<code>Looper -&gt; MessageQueue -&gt; Message -&gt; Handler -&gt; Activity</code>ã€‚ä¸»çº¿ç¨‹çš„Looperå’Œåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç›¸åŒçš„ï¼Œå¦‚æœActivityè¢«<code>finish()</code>äº†ï¼Œä½†Handlerå‘é€çš„æ¶ˆæ¯è¿˜æ²¡æœ‰è¢«å¤„ç†ï¼Œè¿™æ—¶Activityæ˜¯ä¸ä¼šè¢«JVMåˆ¤å®šä¸ºå¯ä»¥å›æ”¶çš„ã€‚</p>
<p>ç”±æ­¤å¯ä»¥åˆ¤æ–­ï¼ŒHandlerå¼•å‘çš„å†…å­˜æ³„æ¼æ˜¯å› ä¸ºåœ¨Activity <code>finish()</code>ä¹‹å‰è°ƒç”¨äº†<code>handler.postDelay()</code>æˆ–è€…<code>handler.sendMessageDelay()</code>ï¼Œåœ¨Activityè¢«finish()åHandlerè¿˜æœ‰æœªå¤„ç†çš„æ¶ˆæ¯å¯¼è‡´çš„ã€‚</p>
<h3 id="å½±å“å‡ ä½•">å½±å“å‡ ä½•</h3>
<p>ç”±äºä¸Šè¿°åŸå› å¯¼è‡´çš„å†…å­˜æ³„æ¼ä¼šå¸¦æ¥ä»€ä¹ˆæ ·çš„å½±å“ï¼Ÿè¢«æ³„æ¼çš„Activityä¸€ç›´éƒ½ä¸ä¼šè¢«å›æ”¶å—ï¼Ÿ</p>
<p>JVMæ“ä½œå†…å­˜çš„åƒåœ¾å›æ”¶ï¼ŒGCä¼šä¸€éåˆä¸€éçš„ã€å‘¨è€Œå¤å§‹çš„æ‰«æå†…å­˜ä¸­å­˜æ´»çš„å¯¹è±¡ï¼Œå¦‚æœè¯¥å¯¹è±¡ç¬¦åˆå›æ”¶æ¡ä»¶ï¼Œå°±ä¼šè¢«å›æ”¶ã€‚</p>
<blockquote>
<p>JVMæœ‰è‹¥å¹²GCç®—æ³•ï¼Œæ¯”å¦‚ï¼Œæ ‡è®°-æ¸…é™¤ã€æ ‡è®°-å¤åˆ¶ã€å¯è¾¾æ€§åˆ†æç­‰ã€‚åƒæ ‡è®°-æ¸…é™¤ï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œå…ˆæ ‡è®°å¯å›æ”¶çš„å¯¹è±¡ï¼Œç­‰ä¸‹æ¬¡GCå‘ç”Ÿæ—¶æ¸…é™¤è¢«æ ‡è®°çš„å¯¹è±¡ã€‚</p>
</blockquote>
<p>å‡å¦‚Activity <code>finish()</code>ä¹‹å‰è°ƒç”¨äº†<code>handler.postDelay({ //è‹¥å¹²æ“ä½œ }, 5000)</code>ï¼Œè§¦å‘äº†5ç§’åçš„å»¶æ—¶æ“ä½œã€‚åœ¨è¿™5ç§’å†…GCå¯èƒ½å¯¹è¯¥Activityæ‰«æäº†ä¸€æ¬¡ï¼Œä¹Ÿå¯èƒ½æ‰«æäº†å¤šæ¬¡ï¼Œæ¯æ¬¡æ‰«æActivity GCéƒ½å‘ç°æœ‰å¼•ç”¨æŒ‡å‘å®ƒï¼Œæ‰€ä»¥è‚¯å®šä¸ä¼šå›æ”¶å®ƒï¼›åˆ°ç¬¬5ç§’ï¼ŒRunnableè¢«Handlerå¤„ç†äº†ï¼ŒæŒ‡å‘è¯¥Activityçš„Messageä¹Ÿè¢«å›æ”¶ï¼Œä¸‹æ¬¡GCå†æ¬¡æ‰«æActivityå‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘å®ƒï¼Œæ­¤æ—¶Activityå³å°†è¢«å›æ”¶ã€‚</p>
<p>ç”±æ­¤å¯ä»¥å¾—å‡ºç»“è®ºï¼šç”±äºHandlerå‘é€å»¶è¿Ÿæ¶ˆæ¯å¯¼è‡´çš„Activityå†…å­˜æ³„æ¼ï¼Œä¼šåœ¨å»¶è¿Ÿæ¶ˆæ¯è¢«å¤„ç†åï¼ŒActivityæ‰ä¼šè¢«GCå›æ”¶ã€‚Activityæ³„æ¼çš„æ—¶é—´é•¿çŸ­å–å†³äºHandlerå‘é€çš„å»¶è¿Ÿæ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ã€‚</p>
<h3 id="è§£å†³å†…å­˜æ³„æ¼">è§£å†³å†…å­˜æ³„æ¼</h3>
<p>æ˜ç¡®äº†Handleræ˜¯æ€ä¹ˆå¯¼è‡´å†…å­˜æ³„æ¼çš„ï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆå®¹æ˜“ï¼š</p>
<ol>
<li>Handlerç”±å†…éƒ¨ç±»çš„å½¢å¼æ”¹æˆé™æ€å†…éƒ¨ç±»çš„å½¢å¼ï¼Œå› ä¸ºé™æ€å†…éƒ¨ç±»ä¸æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼›Handlerä¸æŒæœ‰Activityçš„å¼•ç”¨ï¼Œå³ä¾¿æœ‰å»¶è¿Ÿæ¶ˆæ¯ä¹Ÿä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼</li>
<li>åœ¨Activity <code>finish()</code>ä¹‹å‰è°ƒç”¨<code>handler.removeCallbacksAndMessages(null)</code>ï¼Œç§»é™¤Handlerä¸­æ‰€æœ‰æœªå¤„ç†çš„ä»»åŠ¡ï¼Œè¿™æ ·ä¹Ÿå°±é¿å…äº†å†…å­˜æ³„æ¼<br>
å…·ä½“ä½¿ç”¨ä»€ä¹ˆæ ·çš„ç­–ç•¥å–å†³äºä»£ç çš„ä¸šåŠ¡åœºæ™¯ã€‚</li>
</ol>
<p>è¿™ç¯‡æ–‡ç« åˆ°æ­¤å°±ç»“æŸäº†ã€‚æœ¬æ–‡ä»‹ç»äº†Handlerçš„å·¥ä½œæµç¨‹ï¼Œå¹¶åˆ†æäº†å¸¸è§çš„å‡ ä¸ªHandlerç›¸å…³çš„é¢è¯•é—®é¢˜ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>http://localhost:4000/post/hello-gridea</id>
        <link href="http://localhost:4000/post/hello-gridea">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>